<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bare Bones A-Frame Scene</title>

    <!-- A-Frame Core -->
    <script src="https://cdn.jsdelivr.net/npm/aframe@1.7.1/dist/aframe-master.min.js"></script>

    <!-- PhysX for A-Frame -->
    <script src="../lib/physx.min.js"></script>

    <!-- A-Frame Components -->
    <script src="https://cdn.jsdelivr.net/npm/aframe-environment-component@1.3.7/dist/aframe-environment-component.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.5.4/dist/components/sphere-collider.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.5.4/dist/aframe-extras.controls.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/handy-work@3.1.11/build/handy-controls.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/handy-work@3.1.11/build/magnet-helpers.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-htmlmesh@2.2.0/build/aframe-html.min.js"></script>

    <!-- Local/Custom Scripts -->
    <script src="../model-utils.js"></script>
    <script type="module" src="../js/main.js"></script>
    <script type="module" src="../js/utils/JumpDebug.js"></script>

    <!-- Debug Scripts -->
    <script>
      // Add global error handler
      window.addEventListener('error', function(event) {
        console.error('Global error:', event.error);
      });

      // Log when scene is loaded
      document.addEventListener('DOMContentLoaded', function() {
        const scene = document.querySelector('a-scene');
        if (scene) {
          scene.addEventListener('loaded', function() {
            console.log('Scene loaded for BasePlate/index2.html');
            // Check if components are registered
            console.log('Registered components:', Object.keys(AFRAME.components));
          });
        }
      });
    </script>

    <!-- Stylesheet -->
    <link rel="stylesheet" href="../MOBDESK.css">
</head>
<body>
  <div id="loading-overlay" class="loading-overlay">
    <div class="loading-content">
      <div class="loader"></div>
      <span>Loading...</span>
    </div>
  </div>

  <a-scene
    control-manager
    inspector="url: https://cdn.jsdelivr.net/gh/c-frame/aframe-editor@1.7.0/dist/aframe-editor.min.js"
    stats
    physics="driver: physx; gravity: 0 -9.8 0; maxSubSteps: 5; fixedTimeStep: 1/72; iterations: 10;"
    renderer="antialias: true; precision: mediump; alpha:true; physicallyCorrectLights:True; colorManagement:true; exposure:2; toneMapping:ACESFilmic;"
    physx="autoLoad: true; wasmUrl: ../lib/physx.release.wasm"
    gltf-model="dracoDecoderPath: https://www.gstatic.com/draco/versioned/decoders/1.5.7/;"
    physics-sleep-manager="enabled: true; distanceThreshold: 25; sleepVelocityThreshold: 0.2; inactivityTimeout: 10000; checkInterval: 2000; debug: false;"
    physics-optimizer="enabled: true; mobileFixedTimeStep: 0.033; desktopFixedTimeStep: 0.016; mobileMaxSubSteps: 1; desktopMaxSubSteps: 2; debug: false;"
    physics-sync-manager="enabled: true; minTickRate: 20; maxTickRate: 60; adaptiveSync: true; interpolation: true; debug: true;"
    webxr="overlayElement:#dom-overlay;"
    reflection="directionalLight:#dirlight;"
    shadow="type: pcfsoft"
    xr-mode-ui="XRMode:vr"
    environment="preset: osiris; default-scene: true;" 
    highRefreshRate="true"
    loading-screen-manager
  >
    <a-assets timeout="30000">
      <!-- Bare bones: Assets for cubes might not be needed if using primitives -->
      <!-- Example: <a-asset-item id="cube-model" src="../Assets/models/cube.glb"></a-asset-item> -->
    </a-assets>

    <!-- Camera Rig and Controls -->
    <a-entity
      id="cameraRig"
      jump-control="height: 2.5; upDuration: 500; downDuration: 500; cooldown: 500"
      jump-collider="height: 1.6; radius: 0.5; opacity: 0.2" 
      player-collider="height: 1.6; radius: 0.5"
      position="0 0 0" 
      rotation="0 180 0"
    >
      <!-- Camera -->
      <a-entity
        id="camera"
        camera="near:0.01;"
        look-controls="pointerLockEnabled: true; magicWindowTrackingEnabled: false; reverseMouseDrag: false; touchEnabled: true; smoothingFactor: 0.1"
        position="0 1.65 0"
      >
        <!-- Cursor -->
        <a-entity id="cursor"
           position="0 0 -1"
           geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
           material="color: lime; shader: flat; opacity: 0.9"
           raycaster="objects: .clickable, .pickupable; far: 10"
           cursor="fuse: false;"
        >
        </a-entity>
      </a-entity>

      <!-- Handy Controls -->
      <a-entity
        material="color:gold;metalness:1;roughness:0;"
        handy-controls="materialOverride:right;"
      >
        <!-- Screen space inputs -->
        <a-torus radius="0.008" radius-tubular="0.001" material="shader:flat;color:blue" data-none="screen-0"></a-torus>
        <a-torus radius="0.008" radius-tubular="0.001" material="shader:flat;color:green" data-none="screen-1"></a-torus>
        <a-torus radius="0.008" radius-tubular="0.001" material="shader:flat;color:red" data-none="screen-2"></a-torus>

        <!-- Magnets -->
        <a-entity
          id="left-magnet"
          data-left="grip"
          data-magnet="magnet-left"
          grab-magnet-target="startEvents:squeezestart;stopEvents:squeezeend;noMagnetEl:#left-no-magnet;"
        ></a-entity>
        <a-entity
          id="right-magnet"
          data-right="grip"
          data-magnet="magnet-right"
          grab-magnet-target="startEvents:squeezestart;stopEvents:squeezeend;noMagnetEl:#right-no-magnet;"
        ></a-entity>

        <!-- No-magnet entities (for HTML interface attachment, etc.) -->
        <a-entity id="left-no-magnet" data-left="grip" data-no-magnet>
          <a-entity
            html="html:#my-interface;cursor:#cursor" 
            position="-0.142 -0.0166 -0.02928"
            rotation="-80 90 0"
            scale="0.7 0.7 0.7"
          ></a-entity>
        </a-entity>
        <a-entity id="right-no-magnet" data-right="grip" data-no-magnet></a-entity>

        <!-- Finger tip colliders -->
        <a-sphere data-right="index-finger-tip" radius="0.004" visible="false" physx-body="type: kinematic;"></a-sphere>
        <a-sphere data-right="middle-finger-tip" radius="0.004" visible="false" physx-body="type: kinematic;"></a-sphere>
        <a-sphere data-right="ring-finger-tip" radius="0.004" visible="false" physx-body="type: kinematic;"></a-sphere>
        <a-sphere data-right="pinky-finger-tip" radius="0.004" visible="false" physx-body="type: kinematic;"></a-sphere>
        <a-sphere data-right="thumb-tip" radius="0.004" visible="false" physx-body="type: kinematic;"></a-sphere>
        <a-sphere data-left="index-finger-tip" radius="0.004" visible="false" physx-body="type: kinematic;"></a-sphere>
        <a-sphere data-left="middle-finger-tip" radius="0.004" visible="false" physx-body="type: kinematic;"></a-sphere>
        <a-sphere data-left="ring-finger-tip" radius="0.004" visible="false" physx-body="type: kinematic;"></a-sphere>
        <a-sphere data-left="pinky-finger-tip" radius="0.004" visible="false" physx-body="type: kinematic;"></a-sphere>
        <a-sphere data-left="thumb-tip" radius="0.004" visible="false" physx-body="type: kinematic;"></a-sphere>
      </a-entity>

      <!-- Hand Controllers -->
      <a-entity id="leftHand"
          oculus-touch-controls="hand: left;"
          >
      </a-entity>
      <a-entity id="rightHand"
          oculus-touch-controls="hand: right;"
          >
      </a-entity>

    </a-entity>

    <!-- Lighting -->
    <a-light type="ambient" color="#BBB" intensity="0.5"></a-light>
    <a-light id="dirlight" light="type: directional; castShadow: true;" position="1 3 2" intensity="0.8" shadow-camera-automatic="#cube1,#cube2,#cube3"></a-light>

    <!-- Pickupable Cubes -->
    <a-box
      id="cube1"
      class="pickupable"
      toggle-physics
      shadow="cast:true; receive:true;"
      width="0.5" height="0.5" depth="0.5"
      color="red"
      position="-1 0.25 -2"
      physx-body="type:dynamic; mass:2;"
    >
      <a-entity
        id="cube1-handle1"
        data-magnet-range="0.2,0.1,360,180"
        data-pick-up="parent"
        class="magnet-left magnet-right"
        position="0 0 -0.15" 
        rotation="90 180 90"
      ></a-entity>
      <a-entity
        id="cube1-handle2"
        data-magnet-range="0.2,0.1,360,180"
        data-pick-up="parent"
        class="magnet-left magnet-right"
        position="0 0 0.15"
        rotation="90 180 90"
      ></a-entity>
    </a-box>

    <a-box
      id="cube2"
      class="pickupable"
      toggle-physics
      shadow="cast:true; receive:true;"
      width="0.5" height="0.5" depth="0.5"
      color="blue"
      position="0 0.25 -2"
      physx-body="type:dynamic; mass:2;"
    >
      <a-entity
        id="cube2-handle1"
        data-magnet-range="0.2,0.1,360,180"
        data-pick-up="parent"
        class="magnet-left magnet-right"
        position="0 0 -0.15"
        rotation="90 180 90"
      ></a-entity>
      <a-entity
        id="cube2-handle2"
        data-magnet-range="0.2,0.1,360,180"
        data-pick-up="parent"
        class="magnet-left magnet-right"
        position="0 0 0.15"
        rotation="90 180 90"
      ></a-entity>
    </a-box>

    <a-box
      id="cube3"
      class="pickupable"
      toggle-physics
      shadow="cast:true; receive:true;"
      width="0.5" height="0.5" depth="0.5"
      color="yellow"
      position="1 0.25 -2"
      physx-body="type:dynamic; mass:2;"
    >
      <a-entity
        id="cube3-handle1"
        data-magnet-range="0.2,0.1,360,180"
        data-pick-up="parent"
        class="magnet-left magnet-right"
        position="0 0 -0.15"
        rotation="90 180 90"
      ></a-entity>
      <a-entity
        id="cube3-handle2"
        data-magnet-range="0.2,0.1,360,180"
        data-pick-up="parent"
        class="magnet-left magnet-right"
        position="0 0 0.15"
        rotation="90 180 90"
      ></a-entity>
    </a-box>

  </a-scene>

</body>
</html>
